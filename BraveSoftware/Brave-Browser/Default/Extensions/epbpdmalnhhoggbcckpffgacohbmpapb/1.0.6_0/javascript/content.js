!function(){var e;!function(e){!function(e){e[e.light=0]="light",e[e.dark=1]="dark"}(e.FilterMode||(e.FilterMode={}));var t=e.FilterMode;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.NightMode||(e.NightMode={}));var n=e.NightMode;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.ModeSchedule||(e.ModeSchedule={}));e.ModeSchedule;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.NightSchedule||(e.NightSchedule={}));e.NightSchedule;!function(e){e[e.whiteList=0]="whiteList",e[e.blackList=1]="blackList"}(e.ActiveList||(e.ActiveList={}));var r=e.ActiveList;e.DEFAULT_FILTER_CONFIG={mode:e.FilterMode.dark,nightMode:e.NightMode.off,brightness:100,contrast:100,grayscale:0,sepia:0,warm:0,useFont:!1,fontFamily:"Segoe UI",textStroke:0,invertListed:!1,siteList:[],blackList:[],whiteList:[],activeSiteList:r.blackList,modeSchedule:0,modeScheduleFrom:"23:30",modeScheduleTo:"06:00",nightSchedule:0,nightScheduleFrom:"23:30",nightScheduleTo:"06:00"};var i=function(){function i(){var e=navigator.userAgent.toLowerCase().match(/chrom[e|ium]\/([^ ]+)/);e&&e[1]&&(e[1]<"45.0.2431.0"&&(this.filterAppliesToHtml=!0))}return i.prototype.createShader=function(t,r){var i=e.isUrlInList(r,e.DARK_SITES),o=e.isUrlInList(r,t.siteList);return t.nightMode===n.on&&(o&&t.invertListed||!i&&!t.invertListed&&!o)},i.prototype.getTimeStamp=function(e){if(""!==e)return new Date("01/01/2019 "+e).getTime();var t=(new Date).getHours(),n=(new Date).getMinutes();return new Date("01/01/2019 "+(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)).getTime()},i.prototype.isScheduleOn=function(e,t,n){if(0===e||""===t||""===n)return!0;if(1===e&&""!==t&&""!==n){var r=this.getTimeStamp(t),i=this.getTimeStamp(n),o=this.getTimeStamp("");return r>i&&(i+=864e5),o>=r&&i>=o}},i.prototype.createCssCode=function(i,o){var s=e.isUrlInList(o,e.DARK_SITES),a=e.isUrlInList(o,i.siteList),d=e.isUrlInList(o,i.blackList),u=e.isUrlInList(o,i.whiteList),c=this.isScheduleOn(i.modeSchedule,i.modeScheduleFrom,i.modeScheduleTo),l=this.isScheduleOn(i.nightSchedule,i.nightScheduleFrom,i.nightScheduleTo),h=[];if(h.push("@media screen {"),l&&(i.activeSiteList===r.blackList&&!d||i.activeSiteList===r.whiteList&&u)&&i.nightMode===n.on&&(a&&i.invertListed||!s&&!i.invertListed&&!a)&&(h.push("#screen-shader.on{"),h.push("transition: opacity 0.1s ease 0s;"),h.push("z-index: 2147483647;"),h.push("margin: 0;"),h.push("border-radius: 0;"),h.push("padding: 0;"),h.push("background: #fac563;"),h.push("pointer-events: none;"),h.push("position: fixed;"),h.push("top: -10%;"),h.push("right: -10%;"),h.push("width: 120%;"),h.push("height: 120%;"),h.push("opacity: "+(.8*Number(i.warm)/100+.2)+";"),h.push("mix-blend-mode: multiply;"),h.push("display: block;"),h.push("}")),c&&(i.activeSiteList===r.blackList&&!d||i.activeSiteList===r.whiteList&&u)&&i.mode===t.dark&&(a&&i.invertListed||!s&&!i.invertListed&&!a)){var m=e.getFixesFor(o);if(h.push("\n/* Leading rule */"),h.push(this.createLeadingRule(i)),h.push("\n/* Contrary rule */"),h.push(this.createContraryRule(i,m)),(i.useFont||i.textStroke>0)&&(h.push("\n/* Font */"),h.push("* "+this.createTextDeclaration(i))),h.push("\n/* Text contrast */"),h.push("html {\n  text-shadow: 0 0 0 !important;\n}"),h.push("\n/* Full screen */"),h.push("*:-webkit-full-screen, *:-webkit-full-screen * {\n  -webkit-filter: none !important;\n}"),!this.filterAppliesToHtml){var p=i.mode===t.dark?0:1,g=[[p=(p=p*i.brightness/100)*i.contrast/100-.5*i.contrast/100+.5],[p],[p],[1]],f=i.sepia/100,v=function(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t[0].length;i++){for(var o=0,s=0;s<e[0].length;s++)o+=e[r][s]*t[s][i];n[r][i]=o}}return n}([[.393+.607*(1-f),.769-.769*(1-f),.189-.189*(1-f),0],[.349-.349*(1-f),.686+.314*(1-f),.168-.168*(1-f),0],[.272-.272*(1-f),.534-.534*(1-f),.131+.869*(1-f),0],[0,0,0,1]],g),S=v[0][0],L=v[1][0],y=v[2][0];S>1&&(S=1),S<0&&(S=0),L>1&&(L=1),L<0&&(L=0),y>1&&(y=1),y<0&&(y=0);var I={r:Math.round(255*S),g:Math.round(255*L),b:Math.round(255*y),toString:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}};h.push("\n/* Page background */"),h.push("html {\n  background: "+I+" !important;\n}")}m.rules&&i.mode===t.dark&&(h.push("\n/* Custom rules */"),h.push(m.rules.join("\n")))}return h.push(""),h.push("}"),h.join("\n")},i.prototype.createLeadingRule=function(e){var n="html {\n  -webkit-filter: ";return e.mode===t.dark&&(n+="invert(100%) hue-rotate(180deg) "),n+=100==e.brightness?"":"brightness("+e.brightness+"%) ",n+=100==e.contrast?"":"contrast("+e.contrast+"%) ",n+=0==e.grayscale?"":"grayscale("+e.grayscale+"%) ",n+="!important;\n}"},i.prototype.createContraryRule=function(e,t){var n=[];if(t.invert.length>0){var r=t.invert.join(",\n")+" {\n  -webkit-filter: ";r+="invert(100%) hue-rotate(180deg) ",r+="!important;\n}",n.push(r)}if(t.noinvert.length>0){var i=t.noinvert.join(",\n")+" {\n  -webkit-filter: ";i+="none ",i+="!important;\n}",n.push(i)}if(t.removebg.length>0){var o=t.removebg.join(",\n")+" {\n  background: ";o+="white ",o+="!important;\n}",n.push(o)}return n.join("\n")},i.prototype.createTextDeclaration=function(e){var t="{\n  ";return e.useFont&&(t+=e.fontFamily?"font-family: "+e.fontFamily+" !important; ":""),e.textStroke>0&&(t+=0==e.textStroke?"":"-webkit-text-stroke: "+e.textStroke+"px !important;"),t+="\n}"},i}();function o(e,t){var n=function(e){var t,n,r,i="^"===(e=e.trim())[0],o="$"===e[e.length-1];e=e.replace(/^\^/,"").replace(/\$$/,"").replace(/^.*?\/{2,3}/,"").replace(/\?.*$/,"").replace(/\/$/,""),(t=e.indexOf("/"))>=0?(n=e.substring(0,t),r=e.replace("$","").substring(t)):n=e.replace("$","");var s=i?"^(.*?\\:\\/{2,3})?":"^(.*?\\:\\/{2,3})?([^/]*?\\.)?",a=n.split(".");s+="(";for(var d=0;d<a.length;d++)"*"===a[d]&&(a[d]="[^\\.\\/]+?");s+=a.join("\\."),s+=")",r&&(s+="(",s+=r.replace("/","\\/"),s+=")");return s+=o?"(\\/?(\\?[^/]*?)?)$":"(\\/?.*?)$",new RegExp(s,"i")}(t);return!!e.match(n)}e.FilterCssGenerator=i,e.isUrlInList=function(e,t){for(var n=0;n<t.length;n++)if(o(e,t[n]))return!0;return!1},e.getFixesFor=function(t){var n;if(t)e:for(var r=0;r<e.INVERSION_FIXES.sites.length;r++)for(var i=e.INVERSION_FIXES.sites[r],s="string"==typeof i.url?[i.url]:i.url,a=0;a<s.length;a++)if(o(t,s[a])){n=i;break e}return n||{invert:e.INVERSION_FIXES.common.invert,noinvert:e.INVERSION_FIXES.common.noinvert,removebg:e.INVERSION_FIXES.common.removebg,rules:e.INVERSION_FIXES.common.rules}}}(e||(e={})),chrome.runtime.onMessage.addListener(((t,n,r)=>{const{action:i}=t;if("injectStyles"===i){const{config:n,url:i,DARK_SITES:o,INVERSION_FIXES:s}=t.data;e.DARK_SITES=o,e.INVERSION_FIXES=s,function(t,n){const r=new e.FilterCssGenerator;let i=r.createCssCode(t,n);const o=r.createShader(t,n);var s=function(){a(),i=i.replace(/'/g,"\\'");var e=document.createElement("style");return e.setAttribute("id","dark-reader-style"),e.type="text/css",e.appendChild(document.createTextNode(i)),e},a=function(){var e;if(o)if(null===(e=document.getElementById("screen-shader"))){var t=document.createElement("div");t.id="screen-shader",t.classList.add("on"),document.getElementsByTagName("body")[0].appendChild(t)}else e.classList.add("on"),e.classList.remove("off");else null!==(e=document.getElementById("screen-shader"))&&(e.classList.remove("on"),e.classList.add("off"))};if(document.head){var d=s(),u=document.getElementById("dark-reader-style");u?d.textContent.replace(/^\\s*/gm,"")!==u.textContent.replace(/^\\s*/gm,"")&&(u.parentElement.removeChild(u),document.head.appendChild(d)):document.head.appendChild(d)}else{var c=new MutationObserver((function(e){for(var t=0;t<e.length;t++)if("HEAD"===e[t].target.nodeName){if(c.disconnect(),document.removeEventListener("readystatechange",l),!document.getElementById("dark-reader-style")){var n=s();document.head.appendChild(n)}break}}));c.observe(document,{childList:!0,subtree:!0});var l=function(){if("complete"===document.readyState){if(c.disconnect(),document.removeEventListener("readystatechange",l),!document.head){var e=document.createElement("head");document.documentElement.insertBefore(e,document.documentElement.firstElementChild)}if(!document.getElementById("dark-reader-style")){var t=s();document.head.appendChild(t)}}};document.addEventListener("readystatechange",l),"complete"===document.readyState&&l()}}(n,i),r({ok:!0})}var o;"removeStyles"===i&&((o=document.getElementById("dark-reader-style"))&&o.parentElement.removeChild(o),r({ok:!0}))}))}();