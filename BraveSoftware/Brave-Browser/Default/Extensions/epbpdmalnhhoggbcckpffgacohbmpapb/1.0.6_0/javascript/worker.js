var xp={},__extends=this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r};!function(e){!function(e){function t(e,t){return(t=t||document).querySelector(e)}e.create=function(e,n){var r=document.createElement("div");!function e(t,n){var r;null!=n&&(r="string"==typeof n?document.createTextNode(n):"svg"===n.tag?document.createElementNS("http://www.w3.org/2000/svg","svg"):"http://www.w3.org/1999/xhtml"===t.namespaceURI?document.createElement(n.tag):document.createElementNS(t.namespaceURI,n.tag),"object"==typeof n&&(n.attrs&&Object.keys(n.attrs).forEach((function(e){var t=n.attrs[e];null!=t&&!1!==t&&r.setAttribute(e,!0===t?"":String(t))})),n.children&&n.children.forEach((function(t){e(r,t)}))),t.appendChild(r))}(r,e);var i=r.firstElementChild;for(var o in n){var s=t(o,i);if(!s)throw new Error('Selector "'+o+"\" didn't return anything.");(0,n[o])(s)}return i},e.select=t,e.remove=function(e){return e.parentNode?e.parentNode.removeChild(e):e}}(e.Dom||(e.Dom={}))}(xp),function(e){!function(t){!function(e){e[e.Log=1]="Log",e[e.Info=2]="Info",e[e.Warn=4]="Warn",e[e.Error=8]="Error"}(t.HeatLevel||(t.HeatLevel={}));var n=t.HeatLevel;!function(e){e[e.Misc=16]="Misc",e[e.Binding=32]="Binding",e[e.UI=64]="UI",e[e.Test=128]="Test"}(t.Domain||(t.Domain={}));var r=t.Domain;t.DisplayMessages=n.Info|n.Warn|n.Error|r.Misc|r.Binding|r.UI|r.Test,t.write=function(r,i,o){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];if((i&t.DisplayMessages)>0&&(r&t.DisplayMessages)>0){if("string"==typeof o){s.unshift(o);e.formatString.apply(null,s)}else o;switch(r){case n.Log:case n.Info:case n.Warn:case n.Error:break;default:throw new Error("Not implemented.")}}}}(e.Log||(e.Log={}))}(xp),function(e){e.formatString=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=e,i=0;i<t.length;i++)r=r.replace(new RegExp("\\{"+i+"\\}","gm"),t[i]);return r},e.clone=function(t){var n=[],r=[],i=function(t){var o=n.indexOf(t);if(o>=0)return r[o];var s=typeof t;if(null===t||"string"===s||"boolean"===s||"number"===s||"undefined"===s||"function"===s)return t;if(t instanceof Object){var a;if(t instanceof Date){var c=new Date;c.setDate(t.getTime()),a=c}else if(t instanceof Array){for(var l=[],h=0;h<t.length;h++)l[h]=i(t[h]);a=l}else if(t instanceof e.ObservableCollection){var p=new e.ObservableCollection;for(h=0;h<t.length;h++)p.push(i(t[h]));a=p}else if(t instanceof e.ObservableObject){var u={};for(var d in t)u[d]=i(t[d]);a=e.observable(u)}else{var f=new(0,Object.getPrototypeOf(t).constructor);for(var d in t)t.hasOwnProperty(d)&&(f[d]=i(t[d]));a=f}return n.push(t),r.push(a),a}throw new Error("Item type is not supported for cloning.")};return i(t)},e.createUuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},e.getClassName=function(e){var t=/function\s+(.+?)\s*\(/.exec(e.constructor.toString());return t&&t.length>1?t[1]:""},e.applyConstructor=function(e,t){return new(e.bind.apply(e,[null].concat(t)))},e.hidePrototypeProperties=function(e,t){var n=e.prototype;for(var r in n)if(!t||0===t.length||t.indexOf(r)>=0){var i=Object.getOwnPropertyDescriptor(n,r);i&&i.configurable&&(i.enumerable=!1,Object.defineProperty(n,r,i))}}}(xp),function(e){!function(t){function n(e,t,n){if(void 0===n&&(n=!0),e){if(""===(t=t.replace(/\[(.+)\]/g,".$1")))return e;var r=t.split("."),i=e;return r.every((function(e){if(null==i){if(n)throw new Error('Unable to get property by path "'+t+'".');return!1}return i=i[e],!0})),i}if(n)throw new Error('Unable to get property by path "'+t+'".')}function r(e){var t=(e=e.replace(/\[(.+)\]/g,".$1")).match(/^(.*)\.[^\.]*$/);return t&&t[1]?t[1]:""}function i(e){var t=(e=e.replace(/\[(.+)\]/g,".$1")).match(/(^.*\.)?([^\.]*)$/);return t&&t[2]?t[2]:""}t.getPropertyByPath=n,t.setPropertyByPath=function(t,o,s,a){void 0===a&&(a=!0),t=n(t,r(o),a);var c=i(o);if(!(c in t)&&a)throw new Error(e.formatString('Unable to set property value "{0}" by path "{1}". Property is unreachable.',s,o));t[c]=s},t.getObjectPath=r,t.getPropertyName=i,t.replaceIndexers=function(t){return t.replace(o,(function(n,r){if(!s.test(r))throw new Error(e.formatString('Wrong property identifier. Property: "{0}". Path: "{1}".',t,r));return"."+r}))};var o=/\[(.+?)\]/g,s=/^[0-9A-Z_$]*$/i}(e.Path||(e.Path={}))}(xp),function(e){var t=function(){function e(e){this.pairs=e||[]}return e.prototype.get=function(e){var t=this.pairs.filter((function(t){return t.key===e}));return t.length>0?t[0].value:void 0},e.prototype.set=function(e,t){var n=this.pairs.filter((function(t){return t.key===e}));n.length>0?void 0===t?this.pairs.splice(this.pairs.indexOf(n[0]),1):n[0].value=t:this.pairs.push({key:e,value:t})},e.prototype.remove=function(e){var t=this.pairs.filter((function(t){return t.key===e}));t.length>0&&this.pairs.splice(this.pairs.indexOf(t[0]),1)},e}();e.Dictionary=t}(xp),function(e){var t=function(){function e(){this.handlers=[]}return e.prototype.addHandler=function(e,t){var n={event:this,handler:e,scope:t};if(this.handlers.filter((function(t){return t.handler===e}))[0])throw new Error("Duplicate subscription.");return this.handlers.push(n),n},e.prototype.removeHandler=function(e){var t=this.handlers.filter((function(t){return t.handler===e}))[0];if(!t)throw new Error("Unable to remove event handler :\n"+e.toString());return this.handlers.splice(this.handlers.indexOf(t),1),t.handler},e.prototype.removeAllHandlers=function(){this.handlers=[]},e.prototype.hasHandler=function(e){return this.handlers.filter((function(t){return t.handler===e})).length>0},e.prototype.invoke=function(e){this.handlers.forEach((function(t){t.handler.call(t.scope,e)}))},e}();e.Event=t;var n=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e,t,n){var r=e.addHandler(t,n);return this.subscriptions.push(r),r},e.prototype.unsubscribe=function(e){for(var t;(t=this.subscriptions.indexOf(this.subscriptions.filter(e)[0]))>=0;){var n=this.subscriptions[t];n.event.removeHandler(n.handler),this.subscriptions.splice(t,1)}},e.prototype.unsubscribeAll=function(){this.subscriptions.forEach((function(e){e.event.removeHandler(e.handler)})),this.subscriptions=[]},e}();e.EventRegistrar=n}(xp),function(e){function t(e){return e&&"object"==typeof e&&"onPropertyChanged"in e}e.isNotifier=t;var n=function(){function n(e,t){void 0===t&&(t=!0),this.__initProperties__(),this.__convertNested__=t,e&&this.__copySource__(e)}return n.prototype.__initProperties__=function(){Object.defineProperty(this,"onPropertyChanged",{configurable:!0,value:new e.Event}),Object.defineProperty(this,"__convertNested__",{configurable:!0,writable:!0,value:!0})},n.prototype.__copySource__=function(e){if(e instanceof n)throw new Error("Source object is already observable.");if(Array.isArray(e))throw new Error("Source must not be an array. Use ObservableCollection.");if(!(e instanceof Object))throw new Error("Source must be an object.");for(var t in e)n.extend(this,t,e[t],this.__convertNested__)},n.isConvertable=function(e){return!("object"!=typeof e||t(e)||null===e||e instanceof Date)},n.extend=function(t,r,i,o){if(void 0===o&&(o=!0),r in t)throw new Error('Unable to create notification property. Object already has "'+r+'" property.');if("onPropertyChanged"===r)throw new Error('Unable to create notification property. Reserved name "'+r+'" is used.');if(i instanceof Date){var s=new Date;s.setTime(i.getTime()),i=s}if(o&&n.isConvertable(i)){i=e.observable(i);var a=function(o){n.isConvertable(o)&&(o=e.observable(o)),i=o,t.onPropertyChanged.invoke(r)}}else a=function(e){i=e,t.onPropertyChanged.invoke(r)};Object.defineProperty(t,r,{get:function(){return i},set:a,enumerable:!0,configurable:!0})},n}();e.ObservableObject=n,e.hidePrototypeProperties(n)}(xp),Object.defineProperties(Array.prototype,{move:{value:function(e,t){if(e<0&&(e=this.length+e),t<0&&(t=this.length+t),e>this.length-1||t>this.length-1||e<0||t<0)throw new Error("Index was out of range.");var n=this.splice(e,1)[0];return this.splice(t,0,n),this}},attach:{value:function(e,t){return this.splice(t,0,e),this.length}},detach:{value:function(e){return this.splice(e,1)[0]}}}),function(e){!function(e){e[e.Create=0]="Create",e[e.Replace=1]="Replace",e[e.Delete=2]="Delete",e[e.Move=3]="Move",e[e.Attach=4]="Attach",e[e.Detach=5]="Detach"}(e.CollectionChangeAction||(e.CollectionChangeAction={}));var t=e.CollectionChangeAction;e.isCollectionNotifier=function(e){return e&&"object"==typeof e&&"onCollectionChanged"in e};var n=function(n){function r(e,t){void 0===t&&(t=!0),n.call(this,e,t)}return __extends(r,n),r.prototype.__initProperties__=function(){var t=this;n.prototype.__initProperties__.call(this);var r=function(e,n,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!!r,value:n})};r("onCollectionChanged",new e.Event),r("inner",[],!0),r("sorting",!1,!0),r("splicing",!1,!0)},r.prototype.__copySource__=function(e){var t=this;if(e&&(!Array.isArray(e)||e instanceof r))throw new Error("Source must be an array.");e&&e.forEach((function(e,n){t.add(e,n)}))},r.prototype.add=function(e,n,r){if(e=this.createNotifierIfPossible(e),this.inner.splice(n,0,e),this.appendIndexProperty(),this.onCollectionChanged.invoke({action:r?t.Attach:t.Create,newIndex:n,newItem:e}),this.onPropertyChanged.invoke("length"),!this.__splicing__)for(var i=n;i<this.inner.length;i++)this.onPropertyChanged.invoke(i.toString())},r.prototype.remove=function(e,n){var r=this.inner.splice(e,1)[0];if(this.deleteIndexProperty(),this.onCollectionChanged.invoke({action:n?t.Detach:t.Delete,oldIndex:e,oldItem:r}),this.onPropertyChanged.invoke("length"),!this.__splicing__)for(var i=e;i<this.inner.length+1;i++)this.onPropertyChanged.invoke(i.toString());return r},r.prototype.appendIndexProperty=function(){var e=this,n=this.inner.length-1;Object.defineProperty(this,n.toString(),{get:function(){return e.inner[n]},set:function(r){r=e.createNotifierIfPossible(r),e.onCollectionChanged.invoke({action:t.Replace,oldIndex:n,newIndex:n,oldItem:e.inner[n],newItem:e.inner[n]=r}),e.onPropertyChanged.invoke(n.toString())},enumerable:!0,configurable:!0})},r.prototype.deleteIndexProperty=function(){delete this[this.inner.length]},r.prototype.createNotifierIfPossible=function(t){return this.__convertNested__&&e.ObservableObject.isConvertable(t)&&(t=e.observable(t)),t},Object.defineProperty(r.prototype,"length",{get:function(){return this.inner.length},enumerable:!0,configurable:!0}),r.prototype.move=function(e,n){if(this.inner.move(e,n),this.onCollectionChanged.invoke({action:t.Move,oldIndex:e,newIndex:n,oldItem:this.inner[n],newItem:this.inner[n]}),!this.__sorting__)for(var r=Math.min(e,n);r<=Math.max(e,n);r++)this.onPropertyChanged.invoke(r.toString());return this.inner},r.prototype.attach=function(e,t){return this.add(e,t,!0),this.inner.length},r.prototype.detach=function(e){return this.remove(e,!0)},r.prototype.pop=function(){return this.remove(this.inner.length-1)},r.prototype.push=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];return t.forEach((function(t){e.add(t,e.inner.length)})),this.inner.length},r.prototype.reverse=function(){this.__sorting__=!0;for(var e=this.inner.length,t=0;t<e-1;t++)this.move(0,e-1-t);this.__sorting__=!1;for(t=0;t<e;t++)e%2==1&&Math.floor(e/2)===t||this.onPropertyChanged.invoke(t.toString());return this.inner},r.prototype.shift=function(){return this.remove(0)},r.prototype.sort=function(e){var t=this,n=this.inner.slice(),r=n.slice().sort(e),i=n.map((function(e,t){return{old:t,new:r.indexOf(e)}}));i.sort((function(e,t){return t.new-e.new}));for(var o=0;o<i.length;o++)for(var s=o+1;s<i.length;s++)i[o].old<i[s].old&&i[s].old--;return this.__sorting__=!0,i.forEach((function(e){return e.old!==e.new&&t.move(e.old,e.new)})),this.__sorting__=!1,i.forEach((function(e){e.new!==e.old&&t.onPropertyChanged.invoke(e.new.toString())})),this.inner},r.prototype.splice=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(void 0===e)throw new Error("The specified arguments may lead to unexpected result.");if(e<0&&(e=this.inner.length+e),e<0||e>this.inner.length||t<0)throw new Error("Index was out of range.");t=isNaN(t)?this.inner.length-e:t;var o=this.inner.length;this.__splicing__=!0;for(var s=new Array,a=0;a<t;a++){var c=this.remove(e);s.push(c)}if(r){var l=e;r.forEach((function(e){n.add(e,l),l++}))}this.__splicing__=!1;var h=r?r.length:0,p=this.inner.length,u=t===h?e+h:Math.max(p,o);for(a=e;a<u;a++)this.onPropertyChanged.invoke(a.toString());return s},r.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.splice(0,0,e.length>1?e:e[0]),this.inner.length},r.prototype.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.inner.concat.apply(this.inner,arguments)},r.prototype.join=function(e){return this.inner.join.apply(this.inner,arguments)},r.prototype.slice=function(e,t){return this.inner.slice.apply(this.inner,arguments)},r.prototype.toJSON=function(){return this.inner},r.prototype.toString=function(){return Object.prototype.toString.call(this)},r.prototype.toLocaleString=function(){return this.inner.toLocaleString()},r.prototype.indexOf=function(e,t){return this.inner.indexOf.apply(this.inner,arguments)},r.prototype.lastIndexOf=function(e,t){return this.inner.lastIndexOf.apply(this.inner,arguments)},r.prototype.forEach=function(e,t){return this.inner.forEach.apply(this.inner,arguments)},r.prototype.every=function(e,t){return this.inner.every.apply(this.inner,arguments)},r.prototype.some=function(e,t){return this.inner.some.apply(this.inner,arguments)},r.prototype.filter=function(e,t){return this.inner.filter.apply(this.inner,arguments)},r.prototype.map=function(e,t){return this.inner.map.apply(this.inner,arguments)},r.prototype.reduce=function(e,t){return this.inner.reduce.apply(this.inner,arguments)},r.prototype.reduceRight=function(e,t){return this.inner.reduceRight.apply(this.inner,arguments)},r}(e.ObservableObject);e.ObservableCollection=n,e.hidePrototypeProperties(n)}(xp),function(e){e.observable=function(t,n){if(void 0===n&&(n=!0),e.isNotifier(t))throw new Error("Source object is already observable.");if("object"!=typeof t)throw new Error("Source must be an object.");if(t instanceof Date)throw new Error("Dates cannot be converted into an observable.");return Array.isArray(t)?new e.ObservableCollection(t,n):new e.ObservableObject(t,n)}}(xp),function(e){var t=function(){function t(t,r){var i=this;this.sourceSetToken=!1,this.scope=r,Object.defineProperty(this,"onPropertyChanged",{value:new e.Event});var o=t.match(/\{([^\s\(\)]+?)\}/g),s=[];if(o)for(var a=0;a<o.length;a++){var c=o[a].replace("{","").replace("}","");if(""===c)throw new Error('Empty path binding for expression is not supported. Expression: "'+t+'"');s.indexOf(c)<0&&s.push(c)}this.propsPaths=s;var l=t,h=[];this.params={onPropertyChanged:new e.Event},this.collectionRegistrations={},s.forEach((function(t,n){var r="p"+n;l=l.split("{"+t+"}").join(r),h.push(r);var o="_"+r;i.params[o]=null,Object.defineProperty(i.params,r,{get:function(){return i.params[o]},set:function(t){if(i.collectionRegistrations[r]&&(i.collectionRegistrations[r].unsubscribeAll(),delete i.collectionRegistrations[r]),void 0!==t&&e.isCollectionNotifier(t)){var n=new e.EventRegistrar,s=t;n.subscribe(s.onCollectionChanged,(function(e){i.exec()}),i),i.collectionRegistrations[r]=n}i.params[o]=t,i.sourceSetToken||i.exec()},enumerable:!0,configurable:!0})})),this.func=function(){for(var e={},t=0;t<arguments.length;t++)e["p"+t]=arguments[t];var r=n(l,e);return r},this.managers=[],this.propsPaths.forEach((function(t,n){var r=new e.BindingManager(i.params,h[n],i.scope,t);i.managers.push(r)})),this.exec()}return Object.defineProperty(t.prototype,"result",{get:function(){return this.resultField},set:function(e){this.resultField=e,this.onPropertyChanged.invoke("result")},enumerable:!0,configurable:!0}),t.prototype.exec=function(){var t=[];for(var n in this.params)if("p"===n[0]){var r=this.params[n];r instanceof e.ObservableCollection&&(r=r.slice()),t.push(r)}try{this.resultField=this.func.apply(null,t)}catch(t){e.Log.write(e.Log.HeatLevel.Warn,e.Log.Domain.Binding,"Expression error: "+t),this.resultField=null}this.onPropertyChanged.invoke("result")},t.prototype.resetWith=function(e){this.sourceSetToken=!0,this.scope=e,this.managers.forEach((function(t){t.resetWith(e)})),this.sourceSetToken=!1,this.exec()},t.prototype.unbind=function(){this.managers.forEach((function(e){return e.unbind()})),this.onPropertyChanged.removeAllHandlers()},t}();function n(t,n){var r=function(e){for(var t;t!==e;)t=e,e=e.replace(/\([^\(\)]*\)/g,(function(e){return new Array(e.length+1).join(" ")}));return e},i=function(e){var t=e.replace(/((".*?")|('.*?'))/g,(function(e,t){return new Array(t.length+1).join(" ")})),n=(t=r(t)).indexOf(this.op);return n<0?null:[e.slice(0,n),e.slice(n+this.op.length,e.length)]},o=function(e){var t=e.replace(/((".*?")|('.*?'))/g,(function(e,t){return new Array(t.length+1).join(" ")})),n=(t=r(t)).indexOf(this.op);return n<0?null:[e.slice(n+this.op.length,e.length)]},s=[{op:"?:",fn:function(e,t,n){return e?t:n},split:function(e){var t=e.replace(/((".*?")|('.*?'))/g,(function(e,t){return new Array(t.length+1).join(" ")})),n=(t=r(t)).indexOf(this.op[0]);if(n<0)return null;var i=t.indexOf(this.op[1],n+1);return i<0?null:[e.slice(0,n),e.slice(n+1,i),e.slice(i+1,e.length)]}},{op:"||",fn:function(e,t){return e||t},split:i},{op:"&&",fn:function(e,t){return e&&t},split:i},{op:"!==",fn:function(e,t){return e!==t},split:i},{op:"===",fn:function(e,t){return e===t},split:i},{op:"!=",fn:function(e,t){return e!=t},split:i},{op:"==",fn:function(e,t){return e==t},split:i},{op:">=",fn:function(e,t){return e>=t},split:i},{op:">",fn:function(e,t){return e>t},split:i},{op:"<=",fn:function(e,t){return e<=t},split:i},{op:"<",fn:function(e,t){return e<t},split:i},{op:"-",fn:function(e,t){return e-t},split:i},{op:"+",fn:function(e,t){return e+t},split:i},{op:"/",fn:function(e,t){return e/t},split:i},{op:"*",fn:function(e,t){return e*t},split:i},{op:"typeof",fn:function(e){return typeof e},split:o},{op:"!",fn:function(e){return!e},split:o}],a=function(t,r){if(t=t.trim(),void 0===r&&(r=0),r===s.length){if("("===t[0]&&")"===t[t.length-1])return a(t.slice(1,t.length-1),0);if("true"===t)return!0;if("false"===t)return!1;var i=+t;if(""!==t&&!isNaN(i))return i;if(/^(".*")|('.*')$/.test(t))return t.slice(1,t.length-1);if(t in n)return n[t];if(t in this)return this[t];var o=t.indexOf(".");if(o>=0){var c=t.slice(0,o);if(!(c in n)&&!(c in this))throw new Error("Expression scope doesn't contain \""+c+'".');var l,h=c in n?n[c]:this[c],p=t.slice(o+1,t.length),u=e.Path.getObjectPath(p),d=e.Path.getPropertyByPath(h,u,!1);if("object"!=typeof d||null===d)return void e.Log.write(e.Log.HeatLevel.Info,e.Log.Domain.Binding,"Unable to execute expression: Item supposed to be an object.");if((l=(m=e.Path.getPropertyName(p)).match(/\((.*)\)$/))&&l[1]){m=m.slice(0,l.index);var f=l[1].split(",").map((function(e){return a(e)}));return d[m].apply(d,f)}return d[m]}if((l=t.match(/\((.*)\)$/))&&l[1]){var m=t.slice(0,l.index);f=l[1].split(",").map((function(e){return a(e)}));return d[m].apply(d,f)}throw new Error("Expression scope doesn't contain \""+t+'".')}var g=s[r],v=g.split(t);if(v){for(var y=[],b=0;b<v.length;b++){var E=a(v[b],r);y.push(E)}return g.fn.apply(null,y)}return a(t,r+1)};return a(t)}e.Expression=t,e.hidePrototypeProperties(t),e.evaluate=n}(xp),function(e){var t=function(){function t(t,n,r,i,o){if(!n)throw new Error("Target property path is not set.");if(!i)throw new Error("Unable to bind to empty path.");if(this.target=t,this.targetPropertyPath=n,this.scope=r,this.path=i,this.defaultValue=o,this.pathParts=e.Path.replaceIndexers(i).split("."),!this.pathParts||this.pathParts.length<1)throw new Error(e.formatString('Wrong binding path: "{0}".',i));this.pathParts.forEach((function(t){if(""===t)throw new Error(e.formatString('Unable to bind to empty path. Path: "{0}".',i))})),this.registerPathObjects(),this.updateTarget()}return t.prototype.registerPathObjects=function(t){var n=this;if(void 0===t&&(t=0),this.pathObjects){for(var r=this.pathObjects,i=t;i<r.length-1;i++)e.isNotifier(r[i].obj)&&r[i].obj.onPropertyChanged.removeHandler(r[i].handler);this.pathObjects.splice(t,r.length-t)}var o=this.pathParts;0===t&&(this.pathObjects=[]),this.pathObjects[t]={obj:0===t?this.scope:e.Path.getPropertyByPath(this.scope,o.slice(0,t).join("."))};for(r=this.pathObjects,i=t;i<o.length;i++){var s=o[i];r[i].prop=s;var a,c=r[i].obj;if(!c)break;if(r[i+1]={obj:c[s]},e.isNotifier(c))a=i==o.length-1?function(e){return function(t){t===e&&n.updateTarget()}}(s):function(e,t){return function(r){r===e&&(n.registerPathObjects(t),n.updateTarget())}}(s,i+1),r[i].obj.onPropertyChanged.addHandler(a,this),r[i].handler=a}this.pathObjects=r},t.prototype.resetWith=function(t){this.logMessage(e.formatString('Reset with "{0}".',this.scope)),this.scope=t,this.registerPathObjects(),this.updateTarget()},t.prototype.updateSource=function(){var t=e.Path.getPropertyByPath(this.target,this.targetPropertyPath),n=this.pathParts.length,r=this.pathObjects[n-1].obj;"object"==typeof r&&null!==r?(this.logMessage(e.formatString('Update source "{0}" property with value "{1}".',this.path,t)),r[this.pathParts[n-1]]=t):this.logMessage(e.formatString('Unable to update source property "{0}". It is unreachable.',this.path))},t.prototype.updateTarget=function(){var t=e.Path.getPropertyByPath(this.scope,this.path,!1),n=e.Path.getObjectPath(this.targetPropertyPath),r=e.Path.getPropertyName(this.targetPropertyPath),i=e.Path.getPropertyByPath(this.target,n);null!=t?(this.logMessage(e.formatString('Update target with "{0}" property value "{1}".',this.path,t)),i[r]=t):(this.logMessage(e.formatString('Unable to reach value "{0}". Using default value "{1}".',this.path,this.defaultValue)),i[r]=this.defaultValue)},t.prototype.unbind=function(){if(this.logMessage("Unbind."),this.pathObjects)for(var t=this.pathObjects,n=0;n<t.length-1;n++)e.isNotifier(t[n].obj)&&t[n].obj.onPropertyChanged.removeHandler(t[n].handler)},t.prototype.logMessage=function(t){e.Log.write(e.Log.HeatLevel.Log,e.Log.Domain.Binding,'BM of "{0}#{1}.{2}": {3}',e.getClassName(this.target),this.target.name,this.targetPropertyPath,t)},t}();e.BindingManager=t}(xp),function(e){var t=function(e){function t(t,n,r,i,o){var s;e.call(this,(s={},Object.defineProperty(s,"result",{set:function(e){r(e)},get:function(){if(i)return i()}}),s),"result",t,n,o)}return __extends(t,e),t}(e.BindingManager);e.BindingCallManager=t}(xp),function(e){var t=function(){function t(){Object.defineProperty(this,"onPropertyChanged",{enumerable:!1,configurable:!0,writable:!1,value:new e.Event})}return t.property=function(t,n,r,i){var o=(i=i||{}).convertToObservable||e.isNotifier(r),s=i.convertNested||r instanceof e.ObservableObject&&r.__convertNested__;if(void 0===i.enumerable&&(i.enumerable=!0),i.getterConvertor)var a=i.getterConvertor,c=function(){return a(r)};else c=function(){return r};if(i.setterConvertor){var l=i.setterConvertor;if(o)var h=function(i){e.ObservableObject.isConvertable(i)&&(i=e.observable(i,s)),r=l(i),t.onPropertyChanged.invoke(n)};else h=function(e){r=l(e),t.onPropertyChanged.invoke(n)}}else if(o)h=function(i){e.ObservableObject.isConvertable(i)&&(i=e.observable(i,s)),r=i,t.onPropertyChanged.invoke(n)};else h=function(e){r=e,t.onPropertyChanged.invoke(n)};Object.defineProperty(t,n,{get:c,set:h,configurable:!0,enumerable:i.enumerable})},t.nonEnumerableField=function(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})},t}();e.Model=t,e.property=function(t){return t=t||{},function(n,r){var i=t.convertToObservable,o=t.convertNested,s=void 0===t.enumerable||t.enumerable,a="_"+r;if(t.getterConvertor)var c=t.getterConvertor,l=function(){return c(this[a])};else l=function(){return this[a]};if(t.setterConvertor){var h=t.setterConvertor;if(i)var p=function(t){e.ObservableObject.isConvertable(t)&&(t=e.observable(t,o)),this[a]=h(t),this.onPropertyChanged.invoke(r)};else p=function(e){this[a]=h(e),this.onPropertyChanged.invoke(r)}}else if(i)p=function(t){e.ObservableObject.isConvertable(t)&&(t=e.observable(t,o)),this[a]=t,this.onPropertyChanged.invoke(r)};else p=function(e){this[a]=e,this.onPropertyChanged.invoke(r)};Object.defineProperty(n,r,{get:l,set:p,configurable:!0,enumerable:s}),Object.defineProperty(n,a,{writable:!0,configurable:!0})}}}(xp),function(e){var t=function(){function t(t,n){var r=this;Object.defineProperty(this,"onPropertyChanged",{value:new e.Event}),Object.defineProperty(this,"__registrar__",{value:new e.EventRegistrar});var i=[],o=!1,s=function(e){Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return t[e]},set:function(n){o=!0,t[e]=n,o=!1,r.onPropertyChanged.invoke(e)}}),i.push(e)};for(var a in t)s(a);if(e.isNotifier(t)&&this.__registrar__.subscribe(t.onPropertyChanged,(function(e){o||(i.indexOf(e)<0&&s(e),r.onPropertyChanged.invoke(e))}),this),n){var c=[],l=function(e){Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:function(){return n[e]},set:function(t){o=!0,n[e]=t,o=!1,r.onPropertyChanged.invoke(e)}}),c.push(e)};for(var a in n)i.indexOf(a)<0&&l(a);e.isNotifier(n)&&this.__registrar__.subscribe(n.onPropertyChanged,(function(e){!o&&i.indexOf(e)<0&&(c.indexOf(e)<0&&l(e),r.onPropertyChanged.invoke(e))}),this)}}return t.prototype.unsubscribeScopeFromChanges=function(){this.__registrar__.unsubscribeAll()},t}();e.Scope=t,e.hidePrototypeProperties(t)}(xp),function(e){e.serialize=function(t,n,r,i){return void 0===n&&(n=!0),void 0===i&&(i=" "),JSON.stringify(t,(function(t,i){return n&&null!==i&&"object"==typeof i&&!Array.isArray(i)&&Object.getPrototypeOf(i)!==Object&&(i.__xp_model__=e.getClassName(i)),r&&(i=r(t,i)),i}),i)},e.deserialize=function(t,n,r){var i={};return n&&n.forEach((function(e){var t=e.toString().match(/^function\s*(.*?)\s*\(/)[1];if(t in i)throw new Error('Duplicate model name: "'+t+'".');i[t]=e})),JSON.parse(t,(function(t,n){if(r&&(n=r(t,n)),"object"==typeof n&&null!==n&&"__xp_model__"in n){if("ObservableObject"===n.__xp_model__||"ObservableCollection"===n.__xp_model__)return delete n.__xp_model__,e.observable(n);var o=i[n.__xp_model__];if(!o)throw new Error('No costructor specified for model "'+n.__xp_model__+'".');var s=new o;for(var a in n)"__xp_model__"!==a&&(s[a]=n[a]);return s}return n}))}}(xp),function(e){e.createEventArgs=function(e,t){var n=e.domElement.getBoundingClientRect(),r={domEvent:t,element:e};return"pageX"in t&&(r.elementX=t.pageX-n.left),"pageY"in t&&(r.elementY=t.pageY-n.top),r}}(xp),function(e){var t=function(t){function n(e){var n=this;t.call(this),this.__isRendered__=!1,this.parentScopeChangeHandler=function(){if(n.useParentScope){var e=n.bindings.get("scope");e?e.resetWith(n.parent.scope):n.scope=n.parent.scope}},this.useParentScope=!0,this.initElement(),e&&this.applyMarkup(e),this.init&&this.init(this)}return __extends(n,t),n.prototype.initElement=function(){this.defineProperties(),this.domElement=this.getTemplate(),this.initEvents(),this.setDefaults()},n.prototype.getTemplate=function(){throw new Error("Unable to create an instance of an abstract element.")},n.prototype.renderTo=function(e){e.parentElement.replaceChild(this.domElement,e),this.__setRenderedState__(!0)},n.prototype.__setRenderedState__=function(e){this.__isRendered__=e,e&&this.onRendered&&this.onRendered.invoke(this)},n.prototype.initEvents=function(){var t=this;this.bindings=new e.Dictionary,this.expressions=new e.Dictionary,this.onScopeChanged=new e.Event,this.onRendered=new e.Event,this.onClick=new e.Event,this.onDoubleClick=new e.Event,this.onMouseDown=new e.Event,this.onMouseUp=new e.Event,this.onMouseMove=new e.Event,this.onMouseEnter=new e.Event,this.onMouseLeave=new e.Event,this.onKeyPress=new e.Event,this.onKeyDown=new e.Event,this.onKeyUp=new e.Event,this.onRemoved=new e.Event,this.onRemoved.addHandler((function(){t.onScopeChanged.removeAllHandlers(),t.onRendered.removeAllHandlers(),t.onClick.removeAllHandlers(),t.onDoubleClick.removeAllHandlers(),t.onMouseDown.removeAllHandlers(),t.onMouseUp.removeAllHandlers(),t.onMouseMove.removeAllHandlers(),t.onMouseEnter.removeAllHandlers(),t.onMouseLeave.removeAllHandlers(),t.onKeyPress.removeAllHandlers(),t.onKeyDown.removeAllHandlers(),t.onKeyUp.removeAllHandlers()}),this),this.initSimpleDomEvent("click",this.onClick),this.initSimpleDomEvent("dblclick",this.onDoubleClick),this.initSimpleDomEvent("mousedown",this.onMouseDown),this.initSimpleDomEvent("mouseup",this.onMouseUp),this.initSimpleDomEvent("mousemove",this.onMouseMove),this.initSimpleDomEvent("mouseover",this.onMouseEnter),this.initSimpleDomEvent("mouseout",this.onMouseLeave),this.initSimpleDomEvent("keypress",this.onKeyPress),this.initSimpleDomEvent("keydown",this.onKeyDown),this.initSimpleDomEvent("keyup",this.onKeyUp)},n.prototype.initSimpleDomEvent=function(t,n){var r=this;this.domElement.addEventListener(t,(function(t){var i=e.createEventArgs(r,t);n.invoke(i)}))},n.prototype.applyMarkup=function(t){for(var n in t){var r=t[n];if("string"==typeof r){var i=r.match(/^\{(.*)\}$/),o=r.match(/^\((.*)\)$/);i&&i[1]?this.bind(n,i[1]):o&&o[1]?this.express(n,o[1]):this[n]=r}else this[n]instanceof e.Event?this[n].addHandler(t[n],this):this[n]=r}},n.prototype.defineProperty=function(t,n){var r,i=this;Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:function(){return n.getter?n.getter():r},set:function(o){if(n.acceptedValues&&n.acceptedValues.indexOf(o)<0)throw new Error(e.formatString('The value "{0}" is not accepted for a {1}. List of accepted values: {2}.',o,e.getClassName(i),n.acceptedValues.join(", ")));n.setter&&n.setter(o),r=o,n.observable&&i.onPropertyChanged.invoke(t)}})},n.prototype.defineProperties=function(){var e=this;this.defineProperty("enabled",{setter:function(t){t?(e.domElement.classList.remove("disabled"),e.domElement.style.pointerEvents=""):(e.domElement.classList.add("disabled"),e.domElement.style.pointerEvents="none")},observable:!0}),this.defineProperty("name",{setter:function(t){return e.domElement.id=t},getter:function(){return e.domElement.id}}),this.defineProperty("key",{}),this.defineProperty("width",{setter:function(t){return e.domElement.style.width=t},getter:function(){return e.domElement.offsetWidth+"px"}}),this.defineProperty("height",{setter:function(t){return e.domElement.style.height=t},getter:function(){return e.domElement.offsetHeight+"px"}}),this.defineProperty("minWidth",{setter:function(t){return e.domElement.style.minWidth=t},getter:function(){return e.domElement.style.minWidth}}),this.defineProperty("minHeight",{setter:function(t){return e.domElement.style.minHeight=t},getter:function(){return e.domElement.style.minHeight}}),this.defineProperty("maxWidth",{setter:function(t){return e.domElement.style.maxWidth=t},getter:function(){return e.domElement.style.maxWidth}}),this.defineProperty("maxHeight",{setter:function(t){return e.domElement.style.maxHeight=t},getter:function(){return e.domElement.style.maxHeight}}),this.defineProperty("margin",{setter:function(t){return e.domElement.style.margin=t},getter:function(){return e.domElement.style.margin}});var t="";this.defineProperty("style",{getter:function(){return t},setter:function(n){t&&t.split(" ").forEach((function(t){return e.domElement.classList.remove(t)}));t=n,n.split(" ").forEach((function(t){return e.domElement.classList.add(t)}))}}),this.defineProperty("flex",{setter:function(t){switch(e.domElement.classList.remove("flex-None"),e.domElement.classList.remove("flex-Stretch"),e.domElement.classList.remove("flex-Grow"),e.domElement.classList.remove("flex-Shrink"),t){case"none":e.domElement.classList.add("flex-None");break;case"stretch":e.domElement.classList.add("flex-Stretch");break;case"grow":e.domElement.classList.add("flex-Grow");break;case"shrink":e.domElement.classList.add("flex-Shrink");break;default:throw new Error('Unknown flex value "'+t+'".')}},acceptedValues:["none","shrink","grow","stretch"]}),this.defineProperty("visible",{setter:function(t){t?e.domElement.classList.remove("hidden"):e.domElement.classList.add("hidden")},observable:!0})},n.prototype.setDefaults=function(){this.enabled=!0,this.visible=!0},Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.__setParent__=function(e){if(e&&e.children.indexOf(this)<0)throw new Error('The "parent" property must be set only by parent.');this._parent&&this._parent.onScopeChanged.removeHandler(this.parentScopeChangeHandler),this._parent=e,e&&(this._parent.onScopeChanged.addHandler(this.parentScopeChangeHandler,this),this.parentScopeChangeHandler(),!this.__isRendered__&&e.__isRendered__&&this.__setRenderedState__(!0))},n.prototype.remove=function(){this.detach(),this.bindings.pairs.forEach((function(e){return e.value.unbind()})),this.bindings.pairs.splice(0),this.expressions.pairs.forEach((function(e){return e.value.unbind()})),this.expressions.pairs.splice(0),e.Dom.remove(this.domElement),this.onRemoved.invoke(this),this.onRemoved.removeAllHandlers()},n.prototype.insertBefore=function(e){if(!e.parent)throw new Error("Target element has no parent.");var t;if(this.parent===e.parent){var n=this.parent.children.indexOf(this),r=this.parent.children.indexOf(e);t=n<r?r-1:r}else t=e.parent.children.indexOf(e);e.parent.insert(this,t)},n.prototype.insertAfter=function(e){if(!e.parent)throw new Error("Target element has no parent.");var t;if(this.parent===e.parent){var n=this.parent.children.indexOf(this),r=this.parent.children.indexOf(e);t=n<r?r:r+1}else t=e.parent.children.indexOf(e)+1;e.parent.insert(this,t)},n.prototype.appendTo=function(e){e.append(this)},n.prototype.prependTo=function(e){e.prepend(this)},n.prototype.detach=function(){this.parent&&this.parent.detachChild(this)},n.prototype.bubbleBy=function(e){for(var t=this;t;){if(!0==!!e(t))return t;t=t.parent}return null},n.prototype.focus=function(){this.domElement.focus()},n.prototype.bind=function(t,n,r,i){var o=this.bindings.get(t);if(o&&o.unbind(),""===t||""===n)throw new Error("Binding path cannot be empty.");if("scope"===t&&!this.useParentScope&&!r)throw new Error("Unable to bind element's scope to itself.");r||(this.useParentScope?this.parent&&(r=this.parent.scope):r=this.scope),"string"==typeof t?this.bindings.set(t,new e.BindingManager(this,t,r,n,i)):this.bindings.set(t,new e.BindingCallManager(r,n,t,null,i))},n.prototype.unbind=function(e){var t=this.bindings.get(e);t&&(t.unbind(),this.bindings.remove(e));var n=this.expressions.get(e);n&&(n.unbind(),this.expressions.remove(e))},n.prototype.express=function(t,n,r){var i=this,o=this.expressions.get(t);o&&o.unbind(),o=new e.Expression(n,r||this.scope),this.expressions.set(t,o),"string"==typeof t?this.bindings.set(t,new e.BindingManager(this,t,o,"result")):this.bindings.set(t,new e.BindingCallManager(o,"result",(function(e){return t(e,i)})))},Object.defineProperty(n.prototype,"scope",{get:function(){return this._scope},set:function(t){var n=this;this.bindings.get("scope")&&t!==this.parent.scope&&(t=new e.Scope(t,this.parent.scope)),e.Log.write(e.Log.HeatLevel.Log,e.Log.Domain.UI|e.Log.Domain.Binding,'{0}:{1}: Set data scope "{2}".',e.getClassName(this),this.name||"-",t),this._scope=t,this.bindings.pairs.forEach((function(e){var r=e.key,i=e.value;"scope"===r||n.expressions.get(r)||i.resetWith(t)})),this.expressions.pairs.forEach((function(e){var n=e.key,r=e.value;"scope"!==n&&r.resetWith(t)})),this.onScopeChanged.invoke(t)},enumerable:!0,configurable:!0}),n.prototype.onInput=function(t,n){e.Log.write(e.Log.HeatLevel.Log,e.Log.Domain.UI,'{0}:{1}.{2}: Input "{3}".',e.getClassName(this),this.name||"-",t,n),"string"==typeof t?e.Path.setPropertyByPath(this,t,n):t(n);var r=this.bindings.get(t);r&&r.updateSource()},n}(e.Model);e.Element=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){var t=this;return e.Dom.create({tag:"button",attrs:{class:"Button",type:"button"},children:[{tag:"span",attrs:{class:"wrapper"},children:[{tag:"span",attrs:{class:"icon"}},{tag:"span",attrs:{class:"text"}}]}]},{".icon":function(e){return t.iconElement=e},".text":function(e){return t.textElement=e}})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.icon=null,this.text=""},n.prototype.defineProperties=function(){var n,r=this;t.prototype.defineProperties.call(this),this.defineProperty("icon",{setter:function(t){"string"==typeof t&&""!==t?(n&&("."===n[0]?r.iconElement.classList.remove(n.slice(1)):r.iconElement.style.backgroundImage=""),"*"!==(t=t.trim())&&("."===t[0]?r.iconElement.classList.add(t.slice(1)):r.iconElement.style.backgroundImage=e.formatString("url({0})",t),n=t),r.iconElement.classList.remove("hidden")):r.iconElement.classList.add("hidden")}}),this.defineProperty("text",{setter:function(e){!0==!!e?(r.textElement.textContent=e,r.textElement.classList.remove("hidden")):r.textElement.classList.add("hidden")}})},n}(e.Element);e.Button=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){var t=this;return e.Dom.create({tag:"label",attrs:{class:"CheckBox"},children:[{tag:"input",attrs:{type:"checkbox"}},{tag:"span",attrs:{class:"check"}},{tag:"label",attrs:{class:"text"}}]},{input:function(e){return t.checkElement=e},".text":function(e){return t.textElement=e}})},n.prototype.initEvents=function(){var n=this;t.prototype.initEvents.call(this),this.onCheckChange=new e.Event,this.onRemoved.addHandler((function(){return n.onCheckChange.removeAllHandlers()}),this),this.domElement.addEventListener("change",(function(t){if(!n.readonly){n.onInput("checked",n.checked);var r=e.createEventArgs(n,t);r.checked=n.checked,n.onCheckChange.invoke(r)}}))},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.checked=!1,this.readonly=!1,this.text=""},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("checked",{getter:function(){return e.checkElement.checked},setter:function(t){return e.checkElement.checked=t},observable:!0}),this.defineProperty("text",{setter:function(t){!0==!!t?(e.textElement.textContent=t,e.textElement.classList.remove("hidden")):e.textElement.classList.add("hidden")}}),this.defineProperty("readonly",{setter:function(t){t?(e.checkElement.readOnly=!0,e.domElement.style.pointerEvents="none"):(e.checkElement.readOnly=!1,e.domElement.style.pointerEvents="")}}),this.defineProperty("enabled",{setter:function(t){t?e.domElement.classList.remove("disabled"):e.domElement.classList.add("disabled"),!e.readonly&&t?(e.checkElement.readOnly=!1,e.domElement.style.pointerEvents=""):(e.checkElement.readOnly=!0,e.domElement.style.pointerEvents="none")},observable:!0})},n}(e.Element);e.CheckBox=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"label",attrs:{class:"Label"}})},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("text",{setter:function(t){e.domElement.textContent=t},observable:!0})},n}(e.Element);e.Label=t}(xp),function(e){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"span",attrs:{class:"Placeholder"},children:["&nbsp;"]})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this)},n}(e.Element);e.Placeholder=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){var t=this;return e.Dom.create({tag:"label",attrs:{class:"RadioButton"},children:[{tag:"input",attrs:{type:"radio"}},{tag:"span",attrs:{class:"check"}},{tag:"label",attrs:{class:"text"}}]},{input:function(e){return t.checkElement=e},".text":function(e){return t.textElement=e}})},n.prototype.initEvents=function(){var e=this;t.prototype.initEvents.call(this),this.onCheckChange.addHandler((function(t){t.checked&&e.onInput("selectedItem",e.item)}),this)},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("group",{getter:function(){return e.checkElement.name},setter:function(t){return e.checkElement.name=t}}),this.defineProperty("item",{setter:function(t){e.checked!=(t==e.selectedItem)&&(e.checked=t==e.selectedItem)},observable:!0}),this.defineProperty("selectedItem",{setter:function(t){e.checked!=(t==e.item)&&(e.checked=t==e.item)},observable:!0})},n}(e.CheckBox);e.RadioButton=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){var t=this;return e.Dom.create({tag:"label",attrs:{class:"ToggleButton"},children:[{tag:"input",attrs:{type:"radio"}},{tag:"span",attrs:{class:"icon"}},{tag:"label",attrs:{class:"text"}}]},{input:function(e){return t.checkElement=e},".icon":function(e){return t.iconElement=e},".text":function(e){return t.textElement=e}})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.icon=null},n.prototype.defineProperties=function(){var n,r=this;t.prototype.defineProperties.call(this),this.defineProperty("checked",{getter:function(){return r.checkElement.checked},setter:function(e){r.checkElement.checked=e,e?r.domElement.classList.add("checked"):r.domElement.classList.remove("checked")},observable:!0}),this.defineProperty("icon",{setter:function(t){"string"==typeof t&&""!==t?(n&&("."===n[0]?r.iconElement.classList.remove(n.slice(1)):r.iconElement.style.backgroundImage=""),"*"!==(t=t.trim())&&("."===t[0]?r.iconElement.classList.add(t.slice(1)):r.iconElement.style.backgroundImage=e.formatString("url({0})",t),n=t),r.iconElement.classList.remove("hidden")):r.iconElement.classList.add("hidden")}})},n}(e.RadioButton);e.ToggleButton=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"input",attrs:{class:"TextBox"}})},n.prototype.initEvents=function(){var n=this;t.prototype.initEvents.call(this),this.onTextChange=new e.Event,this.onRemoved.addHandler((function(){return n.onTextChange.removeAllHandlers()}),this);var r="",i=function(t){var i=e.createEventArgs(n,t);i.oldText=r;var o=n.value.toString();i.newText=o,n.onTextChange.invoke(i),n.onInput("text",n.value),n.onInput("value",n.value),r=o};this.domElement.addEventListener("change",(function(e){i(e)})),this.domElement.addEventListener("input",(function(e){n.notifyOnKeyDown&&i(e)}));var o=!!navigator.userAgent.match(/Trident\/7\./);this.domElement.addEventListener("keypress",(function(e){13===e.keyCode&&o&&i(e)}))},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.type="string",this.readonly=!1,this.placeholder=""},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("inputType",{getter:function(){return e.domElement.type},setter:function(t){e.domElement.type=t}}),this.defineProperty("text",{getter:function(){return e.domElement.value},setter:function(t){null==t&&(t=""),e.domElement.value=t},observable:!0}),this.defineProperty("value",{getter:function(){switch(e.type){case"string":return e.text;case"number":return parseFloat(e.text)||0;default:throw new Error("TextBox type value is not implemented.")}},setter:function(t){var n=typeof t;"number"!==n&&"boolean"!==n||(t=t.toString()),null==t&&(t=""),e.text=t},observable:!0}),this.defineProperty("type",{setter:function(t){switch(t){case"string":e.domElement.type="text";break;case"number":e.domElement.type="number";break;default:throw new Error("TextBoxType value is not implemented.")}},acceptedValues:["string","number"]}),this.defineProperty("min",{setter:function(t){return e.domElement.setAttribute("min",t.toString())}}),this.defineProperty("max",{setter:function(t){return e.domElement.setAttribute("max",t.toString())}}),this.defineProperty("step",{setter:function(t){return e.domElement.setAttribute("step",t.toString())}}),this.defineProperty("readonly",{setter:function(t){e.domElement.readOnly=!!t}}),this.defineProperty("placeholder",{getter:function(){return e.domElement.placeholder},setter:function(t){e.domElement.placeholder=t||""}})},n}(e.Element);e.TextBox=t}(xp),function(e){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"textarea",attrs:{class:"TextArea TextBox",spellcheck:"false"}})},n}(e.TextBox);e.TextArea=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.getTemplate=function(){return document.createElement("div")},n.prototype.applyMarkup=function(e){var n={};for(var r in e)n[r]=e[r];if(n.html&&n.url||!n.html&&!n.url)throw new Error('One property, "html" or "url", must be specified.');n.html&&(this.html=n.html,delete n.html),n.url&&(this.url=n.url,delete n.url),t.prototype.applyMarkup.call(this,n)},n.prototype.defineProperties=function(){var n=this;t.prototype.defineProperties.call(this);var r=!1,i=!1,o=!1;this.defineProperty("html",{getter:function(){return n.domElement.outerHTML},setter:function(t){if(!o&&i)throw new Error("Unable to set HTML twice.");var r=e.Dom.create(t);if(1!==r.nodeType)throw new Error("Html control must have one root element.");n.domElement.parentNode&&n.domElement.parentNode.replaceChild(r,n.domElement),n.domElement=r,i=!0,n.initEvents()}}),this.defineProperty("url",{setter:function(e){if(r)throw new Error("Unable to set URL twice.");fetch(e).then((e=>e.text())).then((e=>{r=!0,o=!0,n.html=e,o=!1}))}})},n}(e.Element);e.Html=t}(xp),function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n),r&&r.forEach((function(e){return i.append(e)})),this.cascadeBy((function(t){if(t!==i&&t.name){if(t.name in i)throw new Error(e.formatString('Unable to set named child "{0}". Container\'s property is already defined.',t.name));i[t.name]=t}}))}return __extends(n,t),n.prototype.initElement=function(){this.children=[],t.prototype.initElement.call(this)},n.prototype.getContainerElement=function(){return this.domElement},n.prototype.__setRenderedState__=function(e){this.__isRendered__=e,this.children&&this.children.forEach((function(t){t.__setRenderedState__(e)})),e&&this.onRendered&&this.onRendered.invoke(this)},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("padding",{setter:function(t){return e.domElement.style.padding=t},getter:function(){return e.domElement.style.padding}})},n.prototype.append=function(e){this.insert(e,this.children.length)},n.prototype.prepend=function(e){this.insert(e,0)},n.prototype.insert=function(e,t){if(e.parent!==this||this.children.indexOf(e)!=t){if(t>this.children.length)throw new Error("Index was out or range.");var n=this.getContainerElement();if(e.parent===this){var r=this.children.indexOf(e),i=r<t?t+1:t;i===this.children.length?n.appendChild(e.domElement):n.insertBefore(e.domElement,n.children.item(i)),this.children.move(r,t)}else e.parent&&e.parent.detachChild(e),t===this.children.length?n.appendChild(e.domElement):n.insertBefore(e.domElement,n.children.item(t)),this.children.splice(t,0,e),e.__setParent__(this)}},n.prototype.detachChild=function(t){var n=this.children.indexOf(t);if(n<0)throw new Error("Element is not a child of this container.");this.children.splice(n,1),t.__setParent__(null),e.Dom.remove(t.domElement)},n.prototype.cascadeBy=function(e,t){if(void 0===t&&(t=!1),t&&!0==!!e(this))return this;for(var r=0;r<this.children.length;r++){if(!0==!!e(this.children[r]))return this.children[r];if(this.children[r]instanceof n){var i=this.children[r].cascadeBy(e,!1);if(null!=i)return i}}return null},n.prototype.find=function(e){return this.cascadeBy((function(t){return e(t)}))},n.prototype.findAll=function(e){var t=[];return this.cascadeBy((function(n){e(n)&&t.push(n)})),t},n.prototype.remove=function(){this.removeChildren(),t.prototype.remove.call(this)},n.prototype.removeChildren=function(){for(var e=this.children.length-1;e>=0;e--)this.children[e].remove();this.children=[]},n}(e.Element);e.Container=t}(xp),function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.setDefaults=function(){e.prototype.setDefaults.call(this),this.itemsIndent="none",this.scrollBar="both",this.wrapping="nowrap"},t.prototype.defineProperties=function(){var t=this;e.prototype.defineProperties.call(this),this.defineProperty("itemsIndent",{setter:function(e){switch(t.domElement.classList.remove("itemsIndent-05"),t.domElement.classList.remove("itemsIndent-1"),t.domElement.classList.remove("itemsIndent-2"),t.domElement.classList.remove("itemsIndent-4"),e){case"none":break;case"0.5em":t.domElement.classList.add("itemsIndent-05");break;case"1em":t.domElement.classList.add("itemsIndent-1");break;case"2em":t.domElement.classList.add("itemsIndent-2");break;case"4em":t.domElement.classList.add("itemsIndent-4");break;default:throw new Error("Unknown items indent value: "+e)}},acceptedValues:["none","0.5em","1em","2em","4em"]}),this.defineProperty("scrollBar",{setter:function(e){switch(t.domElement.classList.remove("scrollBar-None"),t.domElement.classList.remove("scrollBar-Horizontal"),t.domElement.classList.remove("scrollBar-Vertical"),t.domElement.classList.remove("scrollBar-Both"),e){case"none":t.domElement.classList.add("scrollBar-None");break;case"horizontal":t.domElement.classList.add("scrollBar-Horizontal");break;case"vertical":t.domElement.classList.add("scrollBar-Vertical");break;case"both":t.domElement.classList.add("scrollBar-Both");break;default:throw new Error("Unknown scroll bar value: "+e)}},acceptedValues:["none","horizontal","vertical","both"]}),this.defineProperty("wrapping",{setter:function(e){switch(t.domElement.classList.remove("wrapping-NoWrap"),t.domElement.classList.remove("wrapping-Wrap"),e){case"nowrap":t.domElement.classList.add("wrapping-NoWrap");break;case"wrap":t.domElement.classList.add("wrapping-Wrap");break;default:throw new Error("Unknown wrapping value: "+e)}},acceptedValues:["nowrap","wrap"]})},t}(e.Container);e.Stack=t}(xp),function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"HBox"}})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.contentAlign="left",this.itemsAlign="stretch"},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("contentAlign",{setter:function(t){switch(e.domElement.classList.remove("contentAlign-Left"),e.domElement.classList.remove("contentAlign-Center"),e.domElement.classList.remove("contentAlign-Right"),t){case"left":e.domElement.classList.add("contentAlign-Left");break;case"center":e.domElement.classList.add("contentAlign-Center");break;case"right":e.domElement.classList.add("contentAlign-Right");break;default:throw new Error("Unknown content alignment value: "+t)}},acceptedValues:["left","center","right"]}),this.defineProperty("itemsAlign",{setter:function(t){switch(e.domElement.classList.remove("itemsAlign-Top"),e.domElement.classList.remove("itemsAlign-Middle"),e.domElement.classList.remove("itemsAlign-Bottom"),e.domElement.classList.remove("itemsAlign-Stretch"),t){case"top":e.domElement.classList.add("itemsAlign-Top");break;case"middle":e.domElement.classList.add("itemsAlign-Middle");break;case"bottom":e.domElement.classList.add("itemsAlign-Bottom");break;case"stretch":e.domElement.classList.add("itemsAlign-Stretch");break;default:throw new Error("Unknown items alignment value: "+t)}},acceptedValues:["top","middle","bottom","stretch"]})},n}(e.Stack);e.HBox=t}(xp),function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"VBox"}})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.contentAlign="top",this.itemsAlign="stretch"},n.prototype.defineProperties=function(){var e=this;t.prototype.defineProperties.call(this),this.defineProperty("contentAlign",{setter:function(t){switch(e.domElement.classList.remove("contentAlign-Top"),e.domElement.classList.remove("contentAlign-Middle"),e.domElement.classList.remove("contentAlign-Bottom"),t){case"top":e.domElement.classList.add("contentAlign-Top");break;case"middle":e.domElement.classList.add("contentAlign-Middle");break;case"bottom":e.domElement.classList.add("contentAlign-Bottom");break;default:throw new Error("Unknown content alignment value: "+t)}},acceptedValues:["top","middle","bottom"]}),this.defineProperty("itemsAlign",{setter:function(t){switch(e.domElement.classList.remove("itemsAlign-Left"),e.domElement.classList.remove("itemsAlign-Center"),e.domElement.classList.remove("itemsAlign-Right"),e.domElement.classList.remove("itemsAlign-Stretch"),t){case"left":e.domElement.classList.add("itemsAlign-Left");break;case"center":e.domElement.classList.add("itemsAlign-Center");break;case"right":e.domElement.classList.add("itemsAlign-Right");break;case"stretch":e.domElement.classList.add("itemsAlign-Stretch");break;default:throw new Error("Unknown items alignment value: "+t)}},acceptedValues:["left","center","right","stretch"]})},n}(e.Stack);e.VBox=t}(xp),function(e){var t=function(t){function n(e){t.call(this,e),this.itemReplacementToken=!1,this.itemReplacementHandlers=[]}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"List VBox"}})},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.itemId="item"},n.prototype.defineProperties=function(){var n=this;t.prototype.defineProperties.call(this),this.defineProperty("items",{setter:function(t){if(n.removeReplacementHandlers(),n.removeChildren(),n.itemsRegistar.unsubscribeAll(),t&&n.itemCreator){if(t.forEach((function(e,t){n.addItem(t,e)})),e.isCollectionNotifier(t)){var r=t;n.itemsRegistar.subscribe(r.onCollectionChanged,(function(t){switch(t.action){case e.CollectionChangeAction.Attach:case e.CollectionChangeAction.Create:n.addItem(t.newIndex,t.newItem);break;case e.CollectionChangeAction.Detach:case e.CollectionChangeAction.Delete:var r=n.itemReplacementHandlers.filter((function(e){return e.item===t.oldItem}))[0];r.holder.onPropertyChanged.removeHandler(r.handler),n.itemReplacementHandlers.splice(n.itemReplacementHandlers.indexOf(r),1),n.children[t.oldIndex].remove();break;case e.CollectionChangeAction.Replace:n.itemReplacementToken||(n.children[t.newIndex].scope[n.itemId]=t.newItem);break;case e.CollectionChangeAction.Move:n.insert(n.children[t.oldIndex],t.newIndex);break;default:throw new Error("Not implemented.")}}),n)}if(e.isNotifier(t)){var i=function(e){};n.itemsRegistar.subscribe(t.onPropertyChanged,i,n)}}}}),this.defineProperty("itemCreator",{setter:function(){return n.items=n.items}})},n.prototype.initEvents=function(){t.prototype.initEvents.call(this),this.itemsRegistar=new e.EventRegistrar},n.prototype.addItem=function(t,n){var r=this.itemCreator(n);r.name=e.createUuid(),r.useParentScope=!1,this.insert(r,t),r.scope=this.createItemScopeFrom(n)},n.prototype.createItemScopeFrom=function(t){var n=this,r={};r[this.itemId]=t;var i=new e.Scope(e.observable(r),this.scope),o={item:t,handler:function(e){if(e===n.itemId){var t=n.items.indexOf(o.item);if(t<0)throw new Error("Item does not belong to List items.");n.itemReplacementToken=!0,n.items[t]=o.holder[e],n.itemReplacementToken=!1,o.item=o.holder[e]}},holder:i};return o.holder.onPropertyChanged.addHandler(o.handler,this),this.itemReplacementHandlers.push(o),i},n.prototype.remove=function(){this.removeReplacementHandlers(),t.prototype.remove.call(this)},n.prototype.removeReplacementHandlers=function(){this.itemReplacementHandlers&&(this.itemReplacementHandlers.forEach((function(e){e.holder.onPropertyChanged.removeHandler(e.handler)})),this.itemReplacementHandlers=[])},n}(e.VBox);e.List=t}(xp),function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.getTemplate=function(){var e=document.body;return e.classList.add("Window"),e.classList.add("VBox"),this.__setRenderedState__(!0),e},n.prototype.initElement=function(){if(t.prototype.initElement.call(this),n.instance)throw new Error("There is already another Window.");n.instance=this},n.prototype.setDefaults=function(){t.prototype.setDefaults.call(this),this.title="XP Application"},n.prototype.defineProperties=function(){t.prototype.defineProperties.call(this),this.defineProperty("title",{getter:function(){return document.title},setter:function(e){return document.title=e},observable:!0})},n.prototype.showModal=function(t){if(this.tint||this.modal)throw new Error("Another modal is displayed.");this.tint=new e.ModalTint,this.tint.appendTo(this),this.modal=t,t.appendTo(this.tint)},n.prototype.closeModal=function(){this.modal.remove(),this.tint.remove(),this.modal=null,this.tint=null},n}(e.VBox);e.Window=t}(xp),function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.show=function(){e.Window.instance.showModal(this)},n.prototype.close=function(){(!this.onClose||this.onClose())&&e.Window.instance.closeModal()},n.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"Modal VBox"}})},n}(e.VBox);e.Modal=t;var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"ModalTint"}})},n}(e.Container);e.ModalTint=n}(xp),function(e){var t=function(t){function n(n,r,i){var o=this;(t.call(this,{padding:"1em 1.5em",width:"32em",margin:"-15% 0 0 0"}),void 0!==r)&&new e.Label({text:r,style:"title",margin:"0 0 1rem 0"}).appendTo(this);void 0!==n&&new e.Label({margin:"0 0 2em 0",text:n,style:"message"}).appendTo(this);i=i||{OK:function(){}};var s=new e.HBox({contentAlign:"right"});for(var a in i)!function(t){new e.Button({text:t,minWidth:"4em",init:function(e){return e.onClick.addHandler((function(){i[t](),o.close()}))}}).appendTo(s)}(a);s.appendTo(this)}return __extends(n,t),n.show=function(e,t,r){new n(e,t,r).show()},n}(e.Modal);e.MessageBox=t}(xp),function(e){var t=function(t){function r(e){var n=this;t.call(this),e.forEach((function(e){return n.createMenuItem(e)}))}return __extends(r,t),r.prototype.getTemplate=function(){return e.Dom.create({tag:"div",attrs:{class:"ContextMenu VBox"}})},r.prototype.createMenuItem=function(e){new n(e,this).appendTo(this)},r.prototype.show=function(t,n){var r=this,i=function(e){r.remove(),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",o)},o=function(e){27===e.keyCode&&i(e)};window.addEventListener("mousedown",i),window.addEventListener("keydown",o),this.domElement.style.left=t+"px",this.domElement.style.top=n+"px",e.Window.instance.append(this);var s=this.domElement.getBoundingClientRect(),a=document.documentElement.getBoundingClientRect();s.right>a.right&&(this.domElement.style.left=t-s.width+"px"),s.bottom>a.bottom&&(this.domElement.style.top=n-s.height+"px")},r.show=function(e,t,n){new r(n).show(e,t)},r}(e.VBox);e.ContextMenu=t;var n=function(t){function n(e,n){t.call(this),this.menu=n,this.initItemData(e)}return __extends(n,t),n.prototype.initItemData=function(t){var n=this;t.icon&&("."===t.icon[0]?this.iconElement.classList.add(t.icon.slice(1)):this.iconElement.style.backgroundImage=e.formatString("url({0})",t.icon)),t.key&&(this.keyElement.textContent=t.key),t.disabled&&(this.enabled=!1),this.textElement.textContent=t.text,this.onMouseDown.addHandler((function(e){e.domEvent.stopPropagation(),n.menu.remove(),t.action()}),this)},n.prototype.getTemplate=function(){var t=e.Dom.create({tag:"span",attrs:{class:"ContextMenuItem",role:"button"},children:[{tag:"span",attrs:{class:"wrapper"},children:[{tag:"span",attrs:{class:"icon"}},{tag:"span",attrs:{class:"text"}},{tag:"span",attrs:{class:"key"}}]}]});return this.iconElement=e.Dom.select(".icon",t),this.textElement=e.Dom.select(".text",t),this.keyElement=e.Dom.select(".key",t),t},n}(e.Element)}(xp),function(e){!function(t){t.assert=function(t){var n=typeof t;if("boolean"!==n)throw new Error("Assert statement must be boolean but not "+n+".");if(!0!==t)throw new Error(e.formatString("Statement is wrong."))},t.assertEqual=function(t,n){if(t!==n)throw new Error(e.formatString('"{0}" is not equal to "{1}".',t,n))}}(e.Tests||(e.Tests={}))}(xp);var DarkReader={};!function(e){var t={remote:"../../assets/config_dark_sites.json",local:"../../assets/config_dark_sites.json"},n={remote:"../../assets/config_inversion.json",local:"../../assets/config_inversion.json"},r={local:"../../assets/config_filters.json"};e.DEBUG=!0;function i(i){function l(t){if(e.DEBUG)throw new Error(t)}Promise.all([c({url:t.local}).then((function(e){return o(e,l)})),c({url:n.local}).then((function(t){e.RAW_INVERSION_FIXES=t,s(p(t),l)})),c({url:r.local}).then((function(e){return a(e,l)}))]).then((function(){return i&&i()}),(function(e){}))}function o(t,n){Array.isArray(t)||(t=[],n&&n("Dark Sites list is not an array."));for(var r=t.length-1;r>=0;r--)"string"!=typeof t[r]&&t.splice(r,1);t.sort(e.urlTemplateSorter),e.DARK_SITES=t}function s(t,n){null!==t&&"object"==typeof t||(t={common:{},sites:[]},n&&n("Inversion Fix config is not an object.")),t.common||(t.common={}),t.common.invert=h(t.common.invert),t.common.noinvert=h(t.common.noinvert),t.common.removebg=h(t.common.removebg),t.common.rules=h(t.common.rules),Array.isArray(t.sites)||(t.sites=[]);for(var r=t.sites.length-1;r>=0;r--){var i=t.sites[r];"string"==typeof(o=i.url)||Array.isArray(o)?(i.invert=h(i.invert),i.noinvert=h(i.noinvert),i.removebg=h(i.removebg),i.rules=h(i.rules)):t.sites.splice(r,1)}var o;t.sites.forEach((function(e){e.invert=t.common.invert.concat(e.invert),e.noinvert=t.common.noinvert.concat(e.noinvert),e.removebg=t.common.removebg.concat(e.removebg),e.rules=t.common.rules.concat(e.rules)})),e.INVERSION_FIXES=t}function a(t,n){if(null!==t&&"object"==typeof t){for(var r in e.DEFAULT_FILTER_CONFIG)typeof t[r]!=typeof e.DEFAULT_FILTER_CONFIG[r]&&(n&&n('Invalid config property "'+r+'"'),t[r]=e.DEFAULT_FILTER_CONFIG[r]);e.DEFAULT_FILTER_CONFIG=t}}function c(e){return fetch(e.url+"?nocache="+(new Date).getTime()).then((e=>e.text())).then((e=>{const t=e.replace(/(\".*?(\\\".*?)*?\")|(\/\*(.|[\r\n])*?\*\/)|(\/\/.*?[\r\n])/gm,"$1");return JSON.parse(t)}))}function l(e,t){var n=function(e){var t,n,r,i="^"===(e=e.trim())[0],o="$"===e[e.length-1];e=e.replace(/^\^/,"").replace(/\$$/,"").replace(/^.*?\/{2,3}/,"").replace(/\?.*$/,"").replace(/\/$/,""),(t=e.indexOf("/"))>=0?(n=e.substring(0,t),r=e.replace("$","").substring(t)):n=e.replace("$","");var s=i?"^(.*?\\:\\/{2,3})?":"^(.*?\\:\\/{2,3})?([^/]*?\\.)?",a=n.split(".");s+="(";for(var c=0;c<a.length;c++)"*"===a[c]&&(a[c]="[^\\.\\/]+?");s+=a.join("\\."),s+=")",r&&(s+="(",s+=r.replace("/","\\/"),s+=")");return s+=o?"(\\/?(\\?[^/]*?)?)$":"(\\/?.*?)$",new RegExp(s,"i")}(t);return!!e.match(n)}function h(e){return Array.isArray(e)?e:e?[e]:[]}function p(e){return JSON.parse(JSON.stringify(e))}e.DARK_SITES,e.INVERSION_FIXES,e.RAW_INVERSION_FIXES,e.loadConfigs=i,e.handleInversionFixes=s,setInterval(i,9e5),e.getFixesFor=function(t){var n;if(t)e:for(var r=0;r<e.INVERSION_FIXES.sites.length;r++)for(var i=e.INVERSION_FIXES.sites[r],o="string"==typeof i.url?[i.url]:i.url,s=0;s<o.length;s++)if(l(t,o[s])){n=i;break e}return n||{invert:e.INVERSION_FIXES.common.invert,noinvert:e.INVERSION_FIXES.common.noinvert,removebg:e.INVERSION_FIXES.common.removebg,rules:e.INVERSION_FIXES.common.rules}},e.isUrlInList=function(e,t){for(var n=0;n<t.length;n++)if(l(e,t[n]))return!0;return!1},e.urlTemplateSorter=function(e,t){"string"==typeof e&&(e={url:e}),"string"==typeof t&&(t={url:t});var n=e.url.indexOf("/"),r=t.url.indexOf("/"),i=e.url.replace("^","").substring(0,n),o=t.url.replace("^","").substring(0,r),s=i.split(".").reverse().join(".").toLowerCase(),a=o.split(".").reverse().join(".").toLowerCase();if(s>a)return-1;if(s<a)return 1;var c=e.url.substring(n),l=t.url.substring(r);return-c.localeCompare(l)},e.formatJson=function(e){return JSON.stringify(e,null,4)+"\n"},e.copyJson=p}(DarkReader),function(e){var t="../icons/dr_active_19.png",n="../icons/dr_active_38.png",r="../icons/dr_inactive_19.png",i="../icons/dr_inactive_38.png",o="DarkModeOn",s="DarkModeOff",a="NightModeOn",c="NightModeOff",l=function(l){function p(e){var t=this;l.call(this),this.darkModeListener=function(e,t){e.name===o&&(t.config.mode=1),e.name===s&&(t.config.mode=0)},this.nightModeListener=function(e,t){e.name===a&&(t.config.nightMode=1),e.name===c&&(t.config.nightMode=0)},this.tabUpdateListener=function(e,n,r){t.addStyleToTab(r)},this.tabReplaceListener=function(e,n){chrome.tabs.get(e,(function(e){return t.addStyleToTab(e)}))},this.generator=e,xp.Model.property(this,"enabled",!1),xp.Model.property(this,"config",null),xp.Model.property(this,"configCopy",null),xp.Model.property(this,"popupOpenCount",0),xp.Model.property(this,"fonts",[]);var n=new xp.EventRegistrar;this.onPropertyChanged.addHandler((function(e){null===t.configCopy&&(t.configCopy=Object.assign({},t.config)),"enabled"===e&&t.onAppToggle(),"config"===e&&(n.unsubscribeAll(),n.subscribe(t.config.onPropertyChanged,t.onConfigPropChanged,t),n.subscribe(t.config.siteList.onCollectionChanged,t.onConfigPropChanged,t),n.subscribe(t.config.blackList.onCollectionChanged,t.onConfigPropChanged,t),n.subscribe(t.config.whiteList.onCollectionChanged,t.onConfigPropChanged,t),t.onConfigPropChanged()),"popupOpenCount"===e&&t.saveUserSettings()})),chrome.action.setIcon({path:{19:r,38:i}}),this.loadUserSettings();var h=this;chrome.commands.onCommand.addListener((function(e){"toggle"===e&&(t.enabled=!t.enabled),"darkModeToggle"===e&&(h.config.mode=0===h.config.mode?1:0),"nightModeToggle"===e&&(h.config.nightMode=0===h.config.nightMode?1:0),t.saveUserSettings()})),this.getFontList((function(e){return t.fonts=e})),chrome.runtime.onSuspend.addListener((function(){chrome.tabs.query({},(function(e){e.forEach(t.removeStyleFromTab,t)}))})),this.addAlarmListeners()}return __extends(p,l),p.prototype.incrementPopupOpenCount=function(e){-1!==this.popupOpenCount&&(this.popupOpenCount=-1===e?e:this.popupOpenCount+e)},p.prototype.addAlarmListeners=function(){var e=this;!0!==e.darkAlarmListenerOn&&(e.darkAlarmListenerOn=!0,chrome.alarms.onAlarm.addListener((function(t){e.darkModeListener(t,e)}))),!0!==e.nightAlarmListenerOn&&(e.nightAlarmListenerOn=!0,chrome.alarms.onAlarm.addListener((function(t){e.nightModeListener(t,e)})))},p.prototype.removeAlarmListeners=function(e){var t=this;e!==c&&e!==a||(chrome.alarms.onAlarm.removeListener(t.nightModeListener),t.nightAlarmListenerOn=!1),e!==s&&e!==o||(chrome.alarms.onAlarm.removeListener(t.darkModeListener),t.darkAlarmListenerOn=!1)},p.prototype.getActiveTabInfo=function(t){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(n){if(1===n.length){var r=n[0].url,i=r.match(/^(.*?:\/{2,3})?(.+?)(\/|$)/)[2],o={url:r,host:i,isProtected:!h(r),isInDarkList:e.isUrlInList(r,e.DARK_SITES)};t(o)}else{if(e.DEBUG)throw new Error("Unexpected tabs count.");t({url:"",host:"",isProtected:!1,isInDarkList:!1})}}))},p.prototype.getTimeStamp=function(e){if(""!==e)return new Date("01/01/2019 "+e).getTime();var t=(new Date).getHours(),n=(new Date).getMinutes();return new Date("01/01/2019 "+(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)).getTime()},p.prototype.isScheduleOn=function(e,t){if(""!==e&&""!==t){var n=this.getTimeStamp(e),r=this.getTimeStamp(t),i=this.getTimeStamp("");return n>r&&(r+=864e5),i>=n&&r>=i}},p.prototype.toggleModeBasedOnSchedule=function(e,t){var n=this.config;if("night"===e){var r=this.isScheduleOn(n.nightScheduleFrom,n.nightScheduleTo);t&&r&&1===n.nightMode?n.nightMode=0:!t&&r&&0===n.nightMode&&(n.nightMode=1)}if("dark"===e){r=this.isScheduleOn(n.modeScheduleFrom,n.modeScheduleTo);t&&r&&1===n.mode?n.mode=0:!t&&r&&0===n.mode&&(n.mode=1)}},p.prototype.toggleCurrentSite=function(e){var t=this;this.getActiveTabInfo((function(n){if(n.host){var r=t.config.blackList.indexOf(n.host);r<0?(null===e||null!==e&&e.element.elementOff.className.search("active")>-1)&&t.config.blackList.push(n.host):(null===e||null!==e&&e.element.elementOn.className.search("active")>-1)&&t.config.blackList.splice(r,1)}}))},p.prototype.onAppToggle=function(){var e=this;this.enabled?(chrome.action.setIcon({path:{19:t,38:n}}),this.addTabListeners(),chrome.tabs.query({active:!0},(function(t){t.forEach(e.addStyleToTab,e)})),chrome.tabs.query({active:!1},(function(t){t.forEach((function(t){setTimeout((function(){return e.addStyleToTab(t)}),0)}))}))):(chrome.action.setIcon({path:{19:r,38:i}}),this.removeTabListeners(),chrome.tabs.query({active:!0},(function(t){t.forEach(e.removeStyleFromTab,e)})),chrome.tabs.query({active:!1},(function(t){t.forEach((function(t){setTimeout((function(){return e.removeStyleFromTab(t)}),0)}))}))),this.saveUserSettings()},p.prototype.clearNightAlarms=function(){this.configCopy.nightSchedule=this.config.nightSchedule,chrome.alarms.clear(c),chrome.alarms.clear(a),this.removeAlarmListeners(a)},p.prototype.clearDarkAlarms=function(){this.configCopy.modeSchedule=this.config.modeSchedule,chrome.alarms.clear(s),chrome.alarms.clear(o),this.removeAlarmListeners(o)},p.prototype.createAlarms=function(){if(0===this.config.nightSchedule)this.clearNightAlarms();else if(1===this.config.nightSchedule&&this.config.nightSchedule!==this.configCopy.nightSchedule){this.clearNightAlarms();var e=this.config.nightScheduleFrom.split(":"),t=this.config.nightScheduleTo.split(":");if(2===e.length&&2===t.length)(n=new Date).setHours(Number(e[0])),n.setMinutes(Number(e[1])),chrome.alarms.create(a,{when:n.getTime(),periodInMinutes:1440}),(r=new Date).setHours(Number(t[0])),r.setMinutes(Number(t[1])),chrome.alarms.create(c,{when:r.getTime(),periodInMinutes:1440}),this.addAlarmListeners()}if(0===this.config.modeSchedule)this.clearDarkAlarms();else if(1===this.config.modeSchedule&&this.config.modeSchedule!==this.configCopy.modeSchedule){this.clearDarkAlarms();var n,r;e=this.config.modeScheduleFrom.split(":"),t=this.config.modeScheduleTo.split(":");if(2===e.length&&2===t.length)(n=new Date).setHours(Number(e[0])),n.setMinutes(Number(e[1])),chrome.alarms.create(o,{when:n.getTime(),periodInMinutes:1440}),(r=new Date).setHours(Number(t[0])),r.setMinutes(Number(t[1])),chrome.alarms.create(s,{when:r.getTime(),periodInMinutes:1440}),this.addAlarmListeners()}},p.prototype.onConfigPropChanged=function(){var e=this;this.enabled&&(this.createAlarms(),chrome.tabs.query({active:!0},(function(t){t.forEach(e.addStyleToTab,e)})),chrome.tabs.query({active:!1},(function(t){t.forEach((function(t){setTimeout((function(){return e.addStyleToTab(t)}),0)}))})))},p.prototype.addTabListeners=function(){chrome.tabs.onUpdated.hasListener(this.tabUpdateListener)||chrome.tabs.onUpdated.addListener(this.tabUpdateListener),chrome.tabs.onReplaced.hasListener(this.tabReplaceListener)||chrome.tabs.onReplaced.addListener(this.tabReplaceListener)},p.prototype.removeTabListeners=function(){chrome.tabs.onUpdated.removeListener(this.tabUpdateListener),chrome.tabs.onReplaced.removeListener(this.tabReplaceListener)},p.prototype.canInjectScript=function(e){return e&&h(e.url)},p.prototype.addStyleToTab=function(t){this.canInjectScript(t)&&chrome.tabs.sendMessage(t.id,{action:"injectStyles",data:{url:t.url,config:this.config,DARK_SITES:e.DARK_SITES,INVERSION_FIXES:e.INVERSION_FIXES}},(e=>{}))},p.prototype.removeStyleFromTab=function(e){this.canInjectScript(e)&&chrome.tabs.sendMessage(e.id,{action:"removeStyles"},(e=>{}))},p.prototype.getCode_addStyle=function(e){},p.prototype.getCode_removeStyle=function(){},p.prototype.loadUserSettings=function(t=(()=>{})){var n=this,r=xp.clone(e.DEFAULT_FILTER_CONFIG),i={enabled:!0,config:r,configCopy:r,installedTimestamp:0,popupOpenCount:0};chrome.storage.sync.get(i,(function(e){if(e.config||(e.config=r),e.configCopy||(e.configCopy=r),!Array.isArray(e.config.siteList)){var i=[];for(var o in e.config.siteList)i[o]=e.config.siteList[o];e.config.siteList=i}if(!Array.isArray(e.config.blackList)){i=[];for(var o in e.config.blackList)i[o]=e.config.blackList[o];e.config.blackList=i}if(!Array.isArray(e.config.whiteList)){i=[];for(var o in e.config.whiteList)i[o]=e.config.whiteList[o];e.config.whiteList=i}n.config=xp.observable(e.config),n.configCopy=Object.assign({},n.config),n.enabled=e.enabled,n.installedTimestamp=e.installedTimestamp,n.popupOpenCount=e.popupOpenCount,t()}))},p.prototype.saveUserSettings=function(){var e=this,t={enabled:e.enabled,config:e.config,configCopy:e.config,popupOpenCount:e.popupOpenCount,installedTimestamp:e.installedTimestamp};chrome.storage.sync.set(t,(function(){e.savedTimeout=null}))},p.prototype.resetToDefault=function(){var t=xp.clone(e.DEFAULT_FILTER_CONFIG);t.mode=this.config.mode,t.nightMode=this.config.nightMode,t.modeSchedule=this.config.modeSchedule,t.modeScheduleFrom=this.config.modeScheduleFrom,t.modeScheduleTo=this.config.modeScheduleTo,t.nightSchedule=this.config.nightSchedule,t.nightScheduleFrom=this.config.nightScheduleFrom,t.nightScheduleTo=this.config.nightScheduleTo,this.config=xp.observable(t),this.configCopy=t,this.saveUserSettings()},p.prototype.getFontList=function(e){chrome.fontSettings?chrome.fontSettings.getFontList((function(t){var n=t.map((function(e){return e.fontId}));e(n)})):setTimeout((function(){return e(["serif","sans-serif","monospace","cursive","fantasy","system-ui"])}))},p.prototype.getSavedDevInversionFixes=function(){return localStorage.getItem("dev_inversion_fixes")||null},p.prototype.saveDevInversionFixes=function(e){localStorage.setItem("dev_inversion_fixes",e)},p.prototype.getDevInversionFixesText=function(){var t=this.getSavedDevInversionFixes();return e.formatJson(t?JSON.parse(t):e.copyJson(e.RAW_INVERSION_FIXES))},p.prototype.resetDevInversionFixes=function(){localStorage.removeItem("dev_inversion_fixes"),e.handleInversionFixes(e.copyJson(e.RAW_INVERSION_FIXES)),this.onConfigPropChanged()},p.prototype.applyDevInversionFixes=function(t,n){var r;try{r=JSON.parse(t);var i=e.formatJson(r);this.saveDevInversionFixes(i),e.handleInversionFixes(r),this.onConfigPropChanged(),n(null)}catch(e){n(e)}},p}(xp.Model);function h(e){return e&&0!==e.indexOf("chrome")&&0!==e.indexOf("https://chrome.google.com/webstore")&&0!==e.indexOf("about:")&&0!==e.indexOf("view-source:")&&0!==e.indexOf("https://addons.mozilla.org")}e.Extension=l}(DarkReader),function(e){!function(e){e[e.light=0]="light",e[e.dark=1]="dark"}(e.FilterMode||(e.FilterMode={}));var t=e.FilterMode;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.NightMode||(e.NightMode={}));var n=e.NightMode;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.ModeSchedule||(e.ModeSchedule={}));e.ModeSchedule;!function(e){e[e.off=0]="off",e[e.on=1]="on"}(e.NightSchedule||(e.NightSchedule={}));e.NightSchedule;!function(e){e[e.whiteList=0]="whiteList",e[e.blackList=1]="blackList"}(e.ActiveList||(e.ActiveList={}));var r=e.ActiveList;e.DEFAULT_FILTER_CONFIG={mode:e.FilterMode.dark,nightMode:e.NightMode.off,brightness:100,contrast:100,grayscale:0,sepia:0,warm:0,useFont:!1,fontFamily:"Segoe UI",textStroke:0,invertListed:!1,siteList:[],blackList:[],whiteList:[],activeSiteList:r.blackList,modeSchedule:0,modeScheduleFrom:"23:30",modeScheduleTo:"06:00",nightSchedule:0,nightScheduleFrom:"23:30",nightScheduleTo:"06:00"};var i=function(){function i(){var e=navigator.userAgent.toLowerCase().match(/chrom[e|ium]\/([^ ]+)/);e&&e[1]&&(e[1]<"45.0.2431.0"&&(this.filterAppliesToHtml=!0))}return i.prototype.createShader=function(t,r){var i=e.isUrlInList(r,e.DARK_SITES),o=e.isUrlInList(r,t.siteList);return t.nightMode===n.on&&(o&&t.invertListed||!i&&!t.invertListed&&!o)},i.prototype.getTimeStamp=function(e){if(""!==e)return new Date("01/01/2019 "+e).getTime();var t=(new Date).getHours(),n=(new Date).getMinutes();return new Date("01/01/2019 "+(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)).getTime()},i.prototype.isScheduleOn=function(e,t,n){if(0===e||""===t||""===n)return!0;if(1===e&&""!==t&&""!==n){var r=this.getTimeStamp(t),i=this.getTimeStamp(n),o=this.getTimeStamp("");return r>i&&(i+=864e5),o>=r&&i>=o}},i.prototype.createCssCode=function(i,o){var s=e.isUrlInList(o,e.DARK_SITES),a=e.isUrlInList(o,i.siteList),c=e.isUrlInList(o,i.blackList),l=e.isUrlInList(o,i.whiteList),h=this.isScheduleOn(i.modeSchedule,i.modeScheduleFrom,i.modeScheduleTo),p=this.isScheduleOn(i.nightSchedule,i.nightScheduleFrom,i.nightScheduleTo),u=[];if(u.push("@media screen {"),p&&(i.activeSiteList===r.blackList&&!c||i.activeSiteList===r.whiteList&&l)&&i.nightMode===n.on&&(a&&i.invertListed||!s&&!i.invertListed&&!a)&&(u.push("#screen-shader.on{"),u.push("transition: opacity 0.1s ease 0s;"),u.push("z-index: 2147483647;"),u.push("margin: 0;"),u.push("border-radius: 0;"),u.push("padding: 0;"),u.push("background: #fac563;"),u.push("pointer-events: none;"),u.push("position: fixed;"),u.push("top: -10%;"),u.push("right: -10%;"),u.push("width: 120%;"),u.push("height: 120%;"),u.push("opacity: "+(.8*Number(i.warm)/100+.2)+";"),u.push("mix-blend-mode: multiply;"),u.push("display: block;"),u.push("}")),h&&(i.activeSiteList===r.blackList&&!c||i.activeSiteList===r.whiteList&&l)&&i.mode===t.dark&&(a&&i.invertListed||!s&&!i.invertListed&&!a)){var d=e.getFixesFor(o);if(u.push("\\n/* Leading rule */"),u.push(this.createLeadingRule(i)),u.push("\\n/* Contrary rule */"),u.push(this.createContraryRule(i,d)),(i.useFont||i.textStroke>0)&&(u.push("\\n/* Font */"),u.push("* "+this.createTextDeclaration(i))),u.push("\\n/* Text contrast */"),u.push("html {\\n  text-shadow: 0 0 0 !important;\\n}"),u.push("\\n/* Full screen */"),u.push("*:-webkit-full-screen, *:-webkit-full-screen * {\\n  -webkit-filter: none !important;\\n}"),!this.filterAppliesToHtml){var f=i.mode===t.dark?0:1,m=[[f=(f=f*i.brightness/100)*i.contrast/100-.5*i.contrast/100+.5],[f],[f],[1]],g=i.sepia/100,v=function(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t[0].length;i++){for(var o=0,s=0;s<e[0].length;s++)o+=e[r][s]*t[s][i];n[r][i]=o}}return n}([[.393+.607*(1-g),.769-.769*(1-g),.189-.189*(1-g),0],[.349-.349*(1-g),.686+.314*(1-g),.168-.168*(1-g),0],[.272-.272*(1-g),.534-.534*(1-g),.131+.869*(1-g),0],[0,0,0,1]],m),y=v[0][0],b=v[1][0],E=v[2][0];y>1&&(y=1),y<0&&(y=0),b>1&&(b=1),b<0&&(b=0),E>1&&(E=1),E<0&&(E=0);var w={r:Math.round(255*y),g:Math.round(255*b),b:Math.round(255*E),toString:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}};u.push("\\n/* Page background */"),u.push("html {\\n  background: "+w+" !important;\\n}")}d.rules&&i.mode===t.dark&&(u.push("\\n/* Custom rules */"),u.push(d.rules.join("\\n")))}return u.push(""),u.push("}"),u.join("\\n")},i.prototype.createLeadingRule=function(e){var n="html {\\n  -webkit-filter: ";return e.mode===t.dark&&(n+="invert(100%) hue-rotate(180deg) "),n+=100==e.brightness?"":"brightness("+e.brightness+"%) ",n+=100==e.contrast?"":"contrast("+e.contrast+"%) ",n+=0==e.grayscale?"":"grayscale("+e.grayscale+"%) ",n+="!important;\\n}"},i.prototype.createContraryRule=function(e,t){var n=[];if(t.invert.length>0){var r=t.invert.join(",\\n")+" {\\n  -webkit-filter: ";r+="invert(100%) hue-rotate(180deg) ",r+="!important;\\n}",n.push(r)}if(t.noinvert.length>0){var i=t.noinvert.join(",\\n")+" {\\n  -webkit-filter: ";i+="none ",i+="!important;\\n}",n.push(i)}if(t.removebg.length>0){var o=t.removebg.join(",\\n")+" {\\n  background: ";o+="white ",o+="!important;\\n}",n.push(o)}return n.join("\\n")},i.prototype.createTextDeclaration=function(e){var t="{\\n  ";return e.useFont&&(t+=e.fontFamily?"font-family: "+e.fontFamily+" !important; ":""),e.textStroke>0&&(t+=0==e.textStroke?"":"-webkit-text-stroke: "+e.textStroke+"px !important;"),t+="\\n}"},i}();e.FilterCssGenerator=i}(DarkReader),function(e){!function(t){t.extension,t.onExtensionLoaded=new xp.Event,chrome.runtime.onInstalled.addListener((function(e){chrome.storage.sync.set({installedTimestamp:(new Date).getTime(),popupOpenCount:0},(function(){}))})),e.loadConfigs((function(){t.extension=new e.Extension(new e.FilterCssGenerator),t.onExtensionLoaded.invoke(t.extension)}))}(e.Background||(e.Background={}))}(DarkReader),chrome.runtime.onMessage.addListener((({action:e},t,n)=>{if("loadConfig"===e)return n({DARK_SITES:DarkReader.DARK_SITES,INVERSION_FIXES:DarkReader.INVERSION_FIXES});"run"===e&&DarkReader.Background.extension.loadUserSettings((()=>{DarkReader.Background.extension.onConfigPropChanged()}))}));